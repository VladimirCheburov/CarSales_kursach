{% extends 'base.html' %}
{% load custom_tags static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %}

{% block content %}
<div class="search-form">
    <form method="get" action="{% url 'search_autos' %}">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π..." class="search-input">
        <button type="submit" class="search-btn">–ù–∞–π—Ç–∏</button>
    </form>
</div>

<!-- –í–∏–¥–∂–µ—Ç 1: –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 2, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –¥–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏) -->
<div>
    <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>
    <ul class="news-list">
        {% for news in latest_news %}
            <li class="news-item">
                <h3 class="news-title">{{ news.title }}</h3>
                <p class="news-content">{{ news.content|truncatewords:20 }}</p>
            </li>
        {% empty %}
            <li class="news-item">–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</li>
        {% endfor %}
    </ul>
    <a href="{% url 'news_list' %}" class="view-all">–ü–µ—Ä–µ–π—Ç–∏ –∫–æ –≤—Å–µ–º –Ω–æ–≤–æ—Å—Ç—è–º ‚Üí</a>
</div>

<!-- –í–∏–¥–∂–µ—Ç 2: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 5, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º) -->
<div>
    <h2 class="section-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏</h2>
    <div class="horizontal-scroll">
        {% for auto in popular_autos %}
        <div class="card" style="min-width: 250px;">
            <a href="{{ auto.get_absolute_url }}">
                {% if auto.auto_photos.first %}
                    <img src="{{ auto.auto_photos.first.photo.url }}" alt="–§–æ—Ç–æ {{ auto.brand.name }}" class="card-img">
                {% else %}
                    <img src="{% static 'images/no_image_available.png' %}" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" class="card-img">
                {% endif %}
                <div class="card-body">
                    <h4 class="card-title">{{ auto.brand.name }} {{ auto.model }}</h4>
                    <p class="card-text">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ auto.year }}</p>
                    <p class="card-price">{{ auto.price|floatformat:0 }} ‚ÇΩ</p>
                    <p class="card-views">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ auto.views }}</p>
                </div>
            </a>
        </div>
        {% empty %}
        <p>–ù–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.</p>
        {% endfor %}
    </div>
</div>

<!-- –í–∏–¥–∂–µ—Ç 3: –°–æ–≤–µ—Ç—ã (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 3, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –¥–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏) -->
<div>
    <h2 class="section-title">–°–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É –∞–≤—Ç–æ</h2>
    <ul class="news-list">
        {% for news in advice_news %}
            <li class="news-item">
                <h3 class="news-title">{{ news.title }}</h3>
                <p class="news-content">{{ news.content|truncatewords:20 }}</p>
            </li>
        {% empty %}
            <li class="news-item">–ù–µ—Ç —Å–æ–≤–µ—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</li>
        {% endfor %}
    </ul>
</div>

<div>
    <!-- —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ç–µ–≥–∏ -->
    <div style="display: flex; gap: 1rem; margin: 1rem 0;">
        <span>–í—Å–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: {% count_total_autos %}</span>
        <span>–ê–≤—Ç–æ–º–æ–±–∏–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {% count_filtered_autos autos_page %}</span>
    </div>

    <h2 class="section-title">–ù–æ–≤—ã–µ –∞–≤—Ç–æ üî•</h2>
    <div class="horizontal-scroll">
        {% get_recent_autos as recent_autos %}
        {% for auto in recent_autos %}
        <div class="card" style="min-width: 250px;">
            <a href="{{ auto.get_absolute_url }}">
                {% if auto.auto_photos.first %}
                    <img src="{{ auto.auto_photos.first.photo.url }}" alt="–§–æ—Ç–æ {{ auto.brand.name }}" class="card-img">
                {% else %}
                    <img src="{% static 'images/no_image_available.png' %}" alt="–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" class="card-img">
                {% endif %}
                <div class="card-body">
                    <h4 class="card-title">{{ auto.brand.name }} {{ auto.model }}</h4>
                    <p class="card-text">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ auto.year }}</p>
                    <p class="card-price">{{ auto.price|floatformat:0 }} ‚ÇΩ</p>
                </div>
            </a>
        </div>
        {% empty %}
        <p>–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.</p>
        {% endfor %}
    </div>
</div>

<div>
    <h2 class="section-title">–ü–æ–¥–æ–±—Ä–∞–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å</h2>
    <div class="grid">
        {% for auto_data in autos_with_photos %}
        <div class="card">
            <a href="{{ auto_data.auto.get_absolute_url }}">
                {% for photo in auto_data.photos %}
                    <img src="{{ photo.photo.url }}" alt="–§–æ—Ç–æ {{ auto_data.auto.brand.name }}" class="card-img">
                    {% if forloop.first %}{% endif %}
                {% endfor %}
                <div class="card-body">
                    <h3 class="card-title">{{ auto_data.auto.brand.name }} {{ auto_data.auto.model }}</h3>
                    <p class="card-text">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ auto_data.auto.year }}</p>
                    <p class="card-price">{{ auto_data.auto.price|floatformat:0 }} ‚ÇΩ</p>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<div class="pagination">
    {% if autos_page.has_previous %}
        <a href="?page=1" class="page-link">–ü–µ—Ä–≤–∞—è</a>
        <a href="?page={{ autos_page.previous_page_number }}" class="page-link">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
    {% endif %}

    <span class="current-page">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ autos_page.number }} –∏–∑ {{ autos_page.paginator.num_pages }}</span>

    {% if autos_page.has_next %}
        <a href="?page={{ autos_page.next_page_number }}" class="page-link">–°–ª–µ–¥—É—é—â–∞—è</a>
        <a href="?page={{ autos_page.paginator.num_pages }}" class="page-link">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
    {% endif %}
</div>

<div>
    <h2 class="section-title">–ö—É–ø–∏–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ üî•</h2>
    <div class="grid">
        {% not_available_autos as autos %}
        {% for auto in autos %}
        <div class="card">
            <div class="card-body">
                <h3 class="card-title">{{ auto.brand.name }} {{ auto.model }}</h3>
                <p class="card-text">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ auto.year }}</p>
                <p class="card-text" style="color: var(--secondary);">–ü—Ä–æ–¥–∞–Ω–æ</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}